<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Đăng nhập / Đăng ký - STYLE GLAMOUR BEATS</title>
    <link rel="stylesheet" href="Untitled-1.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Improved inline styles for the auth page */
        :root{--bg:#f6f7fb;--card:#fff;--accent:#1f2937;--muted:#6b7280;--accent-2:#0ea5a4}
        body{background:linear-gradient(180deg,#fbfdff 0%,var(--bg) 100%);font-family:Inter,system-ui,Segoe UI,Roboto,Arial;margin:0;padding:24px;color:var(--accent)}
        .auth-container{max-width:420px;margin:48px auto;padding:28px;border-radius:12px;background:var(--card);box-shadow:0 6px 22px rgba(31,41,55,0.08);border:1px solid rgba(31,41,55,0.04)}
        h2{margin:0 0 6px;font-size:1.25rem}
        p.lead{margin:0 0 18px;color:var(--muted)}
        .auth-tabs{display:flex;margin-bottom:18px;background:transparent;border-radius:10px;overflow:hidden}
        .auth-tab{flex:1;padding:10px 12px;text-align:center;cursor:pointer;border-bottom:3px solid transparent;color:var(--muted);font-weight:600}
        .auth-tab.active{border-color:var(--accent-2);color:var(--accent);background:linear-gradient(90deg,rgba(14,165,164,0.06),transparent)}
        .auth-form .form-group{margin-bottom:14px}
        .auth-form label{display:block;margin-bottom:8px;font-size:.95rem;color:var(--muted)}
    /* new layout: use flex row for icon + input to guarantee alignment */
    .input-with-icon{display:block}
    .input-row{display:flex;align-items:center;gap:12px}
    /* make the icon column wider so icons sit centered in their column */
    .input-row .icon{width:40px;min-width:40px;height:40px;display:flex;align-items:center;justify-content:center;color:#9ca3af;pointer-events:none}
    .input-row input{flex:1;height:44px;padding:10px 12px;border:1px solid #e6e9ef;border-radius:8px;font-size:0.95rem;background:#f6fbff}
    .input-row .show-pw{background:transparent;border:none;color:#6b7280;padding:6px;border-radius:8px;cursor:pointer;height:34px;width:34px;display:flex;align-items:center;justify-content:center}
    .input-row .show-pw:hover{background:rgba(14,165,164,0.06);color:var(--primary)}
    .input-row .show-pw i{font-size:15px}
        .btn-ghost{background:transparent;border:1px solid #e6e9ef;padding:10px 14px;border-radius:8px;cursor:pointer;color:var(--accent)}
        .btn-primary{background:linear-gradient(90deg,var(--accent-2),#036);color:#fff;border:none;padding:11px 16px;border-radius:10px;cursor:pointer;font-weight:600}
        .auth-footer{margin-top:14px;font-size:.95rem;text-align:center;color:var(--muted)}
        .error{color:#ef4444;font-size:.9rem;margin-top:6px}
        .row{display:flex;gap:10px}
        @media(max-width:480px){.auth-container{margin:20px;padding:18px}}
    </style>
</head>
<body>
    <main>
        <div class="auth-container">
            <h2 style="text-align:center;margin-bottom:8px">Chào mừng đến với STYLE GLAMOUR BEATS</h2>
            <p style="text-align:center;margin-bottom:18px;color:#555">Vui lòng đăng nhập hoặc đăng ký để tiếp tục vào cửa hàng</p>

            <div class="auth-tabs">
                <div id="tabLogin" class="auth-tab active">Đăng nhập</div>
                <div id="tabRegister" class="auth-tab">Đăng ký</div>
            </div>

            <div id="loginBox" class="auth-form">
                <div class="form-group input-with-icon">
                    <label for="loginEmail">Email</label>
                    <div class="input-row">
                        <span class="icon" aria-hidden="true">
                            <svg width="18" height="14" viewBox="0 0 20 14" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                                <path d="M1 1.5h18v11H1z" stroke="#9CA3AF" stroke-width="1.2" fill="#F8FAFC"/>
                                <path d="M1 1.5l9 7 9-7" stroke="#9CA3AF" stroke-width="1.2" fill="none"/>
                            </svg>
                        </span>
                        <input id="loginEmail" type="email" placeholder="email@example.com" aria-label="Email">
                    </div>
                </div>
                <div class="form-group input-with-icon">
                    <label for="loginPassword">Mật khẩu</label>
                    <div class="input-row">
                        <!-- inline SVG lock icon -->
                        <span class="icon" aria-hidden="true">
                            <svg width="16" height="18" viewBox="0 0 16 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <rect x="1.2" y="7" width="13.6" height="9" rx="1.8" stroke="#9CA3AF" stroke-width="1.2" fill="#F8FAFC"/>
                                <path d="M4.5 7V5.5a3.5 3.5 0 017 0V7" stroke="#9CA3AF" stroke-width="1.2" fill="none"/>
                            </svg>
                        </span>
                        <input id="loginPassword" type="password" placeholder="Mật khẩu" aria-label="Mật khẩu">
                        <button type="button" class="show-pw" data-target="loginPassword" aria-pressed="false" aria-label="Hiện mật khẩu" title="Hiện/Ẩn mật khẩu">
                            <i class="fa-regular fa-eye" aria-hidden="true"></i>
                        </button>
                    </div>
                </div>
                <div class="form-group">
                    <button id="loginBtn" class="btn-primary" style="width:100%;">Đăng nhập</button>
                </div>
                <p id="loginError" class="error" aria-live="polite"></p>
            </div>

            <div id="registerBox" class="auth-form" style="display:none">
                <div class="form-group input-with-icon">
                    <label for="regName">Họ và tên</label>
                    <div class="input-row">
                        <span class="icon" aria-hidden="true">
                            <!-- user icon -->
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="8" cy="4.4" r="2.4" stroke="#9CA3AF" stroke-width="1.2" fill="#F8FAFC"/>
                                <path d="M2 13c0-2.8 2.7-4.6 6-4.6s6 1.8 6 4.6" stroke="#9CA3AF" stroke-width="1.2" fill="none"/>
                            </svg>
                        </span>
                        <input id="regName" type="text" placeholder="Nguyễn Văn A" aria-label="Họ và tên">
                    </div>
                </div>

                <div class="form-group input-with-icon">
                    <label for="regEmail">Email</label>
                    <div class="input-row">
                        <span class="icon" aria-hidden="true">
                            <!-- mail icon -->
                            <svg width="18" height="14" viewBox="0 0 20 14" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                                <path d="M1 1.5h18v11H1z" stroke="#9CA3AF" stroke-width="1.2" fill="#F8FAFC"/>
                                <path d="M1 1.5l9 7 9-7" stroke="#9CA3AF" stroke-width="1.2" fill="none"/>
                            </svg>
                        </span>
                        <input id="regEmail" type="email" placeholder="email@example.com" aria-label="Email">
                    </div>
                </div>

                <div class="form-group input-with-icon">
                    <label for="regPassword">Mật khẩu</label>
                    <div class="input-row">
                        <span class="icon" aria-hidden="true">
                            <!-- lock icon -->
                            <svg width="16" height="18" viewBox="0 0 16 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <rect x="1.2" y="7" width="13.6" height="9" rx="1.8" stroke="#9CA3AF" stroke-width="1.2" fill="#F8FAFC"/>
                                <path d="M4.5 7V5.5a3.5 3.5 0 017 0V7" stroke="#9CA3AF" stroke-width="1.2" fill="none"/>
                            </svg>
                        </span>
                        <input id="regPassword" type="password" placeholder="Mật khẩu (tối thiểu 6 ký tự)" aria-label="Mật khẩu">
                        <button type="button" class="show-pw" data-target="regPassword" aria-pressed="false" aria-label="Hiện mật khẩu" title="Hiện/Ẩn mật khẩu">
                            <i class="fa-regular fa-eye" aria-hidden="true"></i>
                        </button>
                    </div>
                </div>

                <div class="form-group">
                    <button id="registerBtn" class="btn-primary" style="width:100%;">Đăng ký</button>
                </div>
                <p id="regError" class="error" aria-live="polite"></p>
            </div>

            <div class="auth-footer">
                <div class="row" style="justify-content:center;margin-bottom:10px">
                    <button id="continueGuest" class="btn-ghost">Tiếp tục xem (không đăng nhập)</button>
                </div>
                <small style="color:#777">Bạn có thể đăng nhập sau khi vào trang</small>
            </div>
        </div>
    </main>

    <script>
        // Static deployment mode: when publishing as static site (GitHub Pages / Netlify)
        // we disable server API calls and rely on the localStorage fallback.
        // Change this to `true` only if you deploy the Node API alongside the static site.
        const SERVER_ENABLED = false;

        // If the page is opened as a file:// URL, show guidance for running a local HTTP server.
        const isFileProtocol = location.protocol === 'file:';
        if (isFileProtocol) {
            const container = document.querySelector('.auth-container');
            container.innerHTML = `
                <div style="padding:18px">
                    <h3 style="color:#c00;margin-top:0">Không mở trực tiếp file</h3>
                    <p>Bạn đang mở trang dưới dạng <code>file://</code>. Vui lòng chạy server tĩnh và mở trang qua HTTP để đăng ký/đăng nhập — localStorage chỉ hoạt động theo origin.</p>
                    <p><strong>Hướng dẫn nhanh (PowerShell):</strong></p>
                    <pre style="background:#f7f7f7;padding:8px;border-radius:6px">Set-Location -LiteralPath 'C:\\project cá nhân\\WEB CỬA HÀNG THỜI TRANG'; python -m http.server 8000</pre>
                    <p>Sau đó mở <a href="http://127.0.0.1:8000/auth.html">http://127.0.0.1:8000/auth.html</a></p>
                </div>
            `;
        } else {
            // Tab toggle
            const tabLogin = document.getElementById('tabLogin');
            const tabRegister = document.getElementById('tabRegister');
            const loginBox = document.getElementById('loginBox');
            const registerBox = document.getElementById('registerBox');
            tabLogin.addEventListener('click', ()=>{ tabLogin.classList.add('active'); tabRegister.classList.remove('active'); loginBox.style.display='block'; registerBox.style.display='none'; });
            tabRegister.addEventListener('click', ()=>{ tabRegister.classList.add('active'); tabLogin.classList.remove('active'); registerBox.style.display='block'; loginBox.style.display='none'; });

            // Simple client-side auth simulation using localStorage
            const loginBtn = document.getElementById('loginBtn');
            const registerBtn = document.getElementById('registerBtn');
            const continueGuest = document.getElementById('continueGuest');

            // Password visibility toggle (modern: FA icons + aria)
            document.querySelectorAll('.show-pw').forEach(btn=>{
                btn.addEventListener('click', ()=>{
                    const id = btn.dataset.target;
                    const input = document.getElementById(id);
                    if(!input) return;
                    const icon = btn.querySelector('i');
                    const showing = input.type !== 'password';
                    if(showing){
                        // currently visible -> hide
                        input.type = 'password';
                        btn.setAttribute('aria-pressed','false');
                        btn.setAttribute('aria-label','Hiện mật khẩu');
                        if(icon){ icon.classList.remove('fa-eye-slash'); icon.classList.add('fa-eye'); icon.classList.remove('fa-solid'); icon.classList.add('fa-regular'); }
                    } else {
                        // currently hidden -> show
                        input.type = 'text';
                        btn.setAttribute('aria-pressed','true');
                        btn.setAttribute('aria-label','Ẩn mật khẩu');
                        if(icon){ icon.classList.remove('fa-eye'); icon.classList.add('fa-eye-slash'); icon.classList.remove('fa-regular'); icon.classList.add('fa-solid'); }
                    }
                });
            });

            function getUsers(){
                try{ return JSON.parse(localStorage.getItem('sgb_users')||'[]'); }catch(e){return []}
            }
            function saveUsers(u){ localStorage.setItem('sgb_users', JSON.stringify(u)); }

            registerBtn.addEventListener('click', async (e)=>{
                e.preventDefault();
                const name = document.getElementById('regName').value.trim();
                const email = document.getElementById('regEmail').value.trim().toLowerCase();
                const pw = document.getElementById('regPassword').value;
                const err = document.getElementById('regError'); err.textContent='';
                if(!name||!email||pw.length<6){ err.textContent='Vui lòng nhập đủ thông tin (mật khẩu >= 6 ký tự)'; return; }

                // If server API is enabled we attempt it; otherwise use the localStorage fallback immediately.
                if (SERVER_ENABLED) {
                    try{
                        const resp = await fetch('/api/register', {
                            method: 'POST', headers: {'Content-Type':'application/json'},
                            body: JSON.stringify({name,email,password:pw})
                        });
                        if(resp.ok){
                            const data = await resp.json();
                            localStorage.setItem('sgb_logged_in', JSON.stringify({name:data.name,email:data.email}));
                            window.location.href = 'SGBweb.html';
                            return;
                        } else {
                            const errj = await resp.json().catch(()=>({error:'Server error'}));
                            err.textContent = errj.error || 'Đăng ký không thành công';
                            return;
                        }
                    }catch(e){
                        // server failed, fallthrough to local fallback below
                        console.warn('Server register failed, using local fallback', e);
                    }
                }

                // localStorage fallback
                const users = getUsers();
                if(users.find(u=>u.email===email)){ err.textContent='Email đã được đăng ký'; return; }
                users.push({name,email,password:pw}); saveUsers(users);
                localStorage.setItem('sgb_logged_in', JSON.stringify({name,email}));
                window.location.href = 'SGBweb.html';
            });

            loginBtn.addEventListener('click', async (e)=>{
                e.preventDefault();
                const email = document.getElementById('loginEmail').value.trim().toLowerCase();
                const pw = document.getElementById('loginPassword').value;
                const err = document.getElementById('loginError'); err.textContent='';
                if(!email||!pw){ err.textContent='Vui lòng nhập email và mật khẩu'; return; }

                if (SERVER_ENABLED) {
                    try{
                        const resp = await fetch('/api/login', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({email,password:pw}) });
                        if(resp.ok){
                            const data = await resp.json();
                            localStorage.setItem('sgb_logged_in', JSON.stringify({name:data.name,email:data.email}));
                            window.location.href = 'SGBweb.html';
                            return;
                        } else {
                            const errj = await resp.json().catch(()=>({error:'Server error'}));
                            err.textContent = errj.error || 'Đăng nhập không thành công';
                            return;
                        }
                    }catch(e){
                        console.warn('Server login failed, using local fallback', e);
                        // fallthrough to local fallback
                    }
                }

                // localStorage fallback
                const users = getUsers();
                const user = users.find(u=>u.email===email && u.password===pw);
                if(!user){ err.textContent='Email hoặc mật khẩu không đúng'; return; }
                localStorage.setItem('sgb_logged_in', JSON.stringify({name:user.name,email:user.email}));
                window.location.href = 'SGBweb.html';
            });

            continueGuest.addEventListener('click', (e)=>{
                e.preventDefault();
                // mark as guest session (optional)
                localStorage.setItem('sgb_logged_in', JSON.stringify({name:'Khách',email:''}));
                window.location.href = 'SGBweb.html';
            });
        }
    </script>
</body>
</html>
